factorypulse-backend/
â”‚
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”œâ”€â”€ database.js              # Database connections (MongoDB & PostgreSQL)
â”‚   â”‚   â””â”€â”€ corsConfig.js            # CORS middleware configuration
â”‚   â”‚
â”‚   â”œâ”€â”€ controllers/
â”‚   â”‚   â””â”€â”€ sensorDataController.js  # HTTP request handlers for sensor APIs
â”‚   â”‚
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â””â”€â”€ SensorData.js            # Mongoose & Sequelize models (dual DB support)
â”‚   â”‚
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ thingSpeakService.js     # Scheduled ThingSpeak data fetching
â”‚   â”‚   â””â”€â”€ sensorDataService.js     # Business logic for sensor data operations
â”‚   â”‚
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â””â”€â”€ sensorDataRoutes.js      # API route definitions (/api/data/*)
â”‚   â”‚
â”‚   â””â”€â”€ server.js                    # Main application entry point
â”‚
â”œâ”€â”€ .env                             # Environment variables (DB config, API keys)
â”œâ”€â”€ .gitignore                       # Git ignore file
â”œâ”€â”€ package.json                     # NPM dependencies and scripts
â”œâ”€â”€ README.md                        # Complete documentation
â”œâ”€â”€ SETUP.md                         # Quick setup guide
â”œâ”€â”€ SPRING_TO_MERN_MAPPING.md       # Spring Boot comparison
â””â”€â”€ PROJECT_STRUCTURE.txt            # This file

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

KEY FILES EXPLAINED:

ğŸ“„ .env
   - Database selection (DB_TYPE: mongodb or postgresql)
   - MongoDB Atlas connection string
   - PostgreSQL credentials
   - ThingSpeak API URL and key
   - CORS allowed origins

ğŸ“„ src/config/database.js
   - MongoDB connection using Mongoose
   - PostgreSQL connection using Sequelize
   - Auto-initialization based on DB_TYPE
   - Connection pooling and error handling

ğŸ“„ src/config/corsConfig.js
   - CORS middleware setup
   - Allowed origins from environment
   - HTTP methods configuration

ğŸ“„ src/models/SensorData.js
   - Mongoose schema for MongoDB
   - Sequelize model for PostgreSQL
   - Factory function to get correct model based on DB_TYPE
   - Fields: temperature, vibration, current, timestamp

ğŸ“„ src/services/thingSpeakService.js
   - Fetches data from ThingSpeak API every 60 seconds
   - Uses node-cron for scheduling
   - Parses JSON response (field1, field2, field3)
   - Saves to database (works with both MongoDB & PostgreSQL)

ğŸ“„ src/services/sensorDataService.js
   - getRecentData(): Returns latest sensor reading
   - getAllData(): Returns all sensor readings (sorted by timestamp)
   - convertToDto(): Transforms database objects to DTOs
   - Database-agnostic (works with both DBs)

ğŸ“„ src/controllers/sensorDataController.js
   - getRecentSensorData(): Handles GET /api/data/recent
   - getAllSensorData(): Handles GET /api/data/all
   - Error handling and HTTP status codes

ğŸ“„ src/routes/sensorDataRoutes.js
   - Defines API routes
   - Maps routes to controller methods
   - Mounted at /api/data in server.js

ğŸ“„ src/server.js
   - Express app initialization
   - Middleware setup (CORS, JSON parsing)
   - Route mounting
   - Database initialization
   - ThingSpeak service startup
   - Health check endpoint
   - Graceful shutdown handling

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

API ENDPOINTS:

âœ… GET /health
   Response: Server status and database type

âœ… GET /api/data/recent
   Response: Latest sensor reading (temperature, vibration, current, timestamp)

âœ… GET /api/data/all
   Response: Array of all sensor readings (sorted by timestamp ASC)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

DATA FLOW:

1. ThingSpeak â†’ Backend
   â° Every 60 seconds, thingSpeakService fetches data
   ğŸ“¡ Axios GET request to ThingSpeak API
   ğŸ’¾ Saves to database (MongoDB or PostgreSQL)

2. Frontend â†’ Backend
   ğŸŒ React app calls /api/data/recent or /api/data/all
   ğŸ”„ Controller â†’ Service â†’ Model â†’ Database
   ğŸ“¤ Returns JSON response

3. Database Operations
   ğŸ“¥ Insert: New sensor readings from ThingSpeak
   ğŸ“Š Query: Recent data (DESC by timestamp, limit 1)
   ğŸ“ˆ Query: All data (ASC by timestamp)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

TECHNOLOGY STACK:

Backend Framework:     Express.js
Database (Option 1):   MongoDB Atlas (Cloud)
Database (Option 2):   PostgreSQL (Local)
ORM (MongoDB):         Mongoose
ORM (PostgreSQL):      Sequelize
HTTP Client:           Axios
Scheduling:            node-cron
CORS:                  cors middleware
Environment Config:    dotenv

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

COMMANDS:

Install dependencies:   npm install
Run (development):      npm run dev
Run (production):       npm start

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
